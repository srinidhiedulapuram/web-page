<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Appointment Manager — Health Scheduler</title>
  <style>
    :root{--bg:#f6f8fb;--card:#fff;--accent:#0b76ef;--muted:#6b7280;--danger:#ef4444;--success:#10b981}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    body{margin:0;background:var(--bg);color:#0f172a}
    header{background:linear-gradient(90deg,var(--accent),#2bb7ff);color:white;padding:20px}
    .container{max-width:1100px;margin:18px auto;padding:0 16px}
    h1{margin:0;font-size:20px}
    .lead{opacity:0.95;margin-top:6px}

    /* layout */
    .grid{display:grid;grid-template-columns:320px 1fr;gap:18px;margin-top:18px}
    .panel{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 10px 30px rgba(2,6,23,0.06)}

    /* left column */
    .stats{display:flex;flex-direction:column;gap:10px}
    .stat{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:linear-gradient(180deg,#fff,#fbfdff)}
    .stat strong{font-size:18px}
    .small{font-size:13px;color:var(--muted)}

    /* calendar */
    .calendar{margin-top:10px}
    .cal-days{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .cal-day{padding:8px;text-align:center;border-radius:8px;cursor:pointer}
    .cal-day.has-appoint{background:linear-gradient(180deg,#fff,#f0f9ff);border:1px solid rgba(11,118,239,0.12)}

    /* main area */
    .toolbar{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .search{flex:1}
    input, select, button{padding:8px;border-radius:8px;border:1px solid #e6e9f2}
    .btn{background:var(--accent);color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(11,118,239,0.1)}

    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;text-align:left;border-bottom:1px solid #f1f5f9}
    th{background:transparent;font-weight:600}
    .status{padding:6px 8px;border-radius:999px;font-size:13px}
    .status.pending{background:#fff7ed;color:#b45309}
    .status.completed{background:rgba(16,185,129,0.12);color:var(--success)}
    .status.cancelled{background:rgba(239,68,68,0.08);color:var(--danger)}

    .actions button{margin-right:6px}

    /* modal */
    .overlay{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;padding:20px}
    .overlay.show{display:flex}
    .modal{background:var(--card);width:100%;max-width:760px;border-radius:10px;padding:16px}
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}

    /* alerts */
    .alerts{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .alert{padding:10px;border-radius:8px;color:white}
    .alert.warn{background:#f59e0b}
    .alert.danger{background:var(--danger)}

    footer{margin:24px auto;max-width:1100px;padding:12px 16px;color:var(--muted)}

    @media (max-width:880px){.grid{grid-template-columns:1fr;}.calendar{display:none}}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Appointment Manager</h1>
      <div class="lead">Manage patients, queues and alerts — local demo (data stored in browser)</div>
    </div>
  </header>

  <main class="container grid">
    <aside class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Today</strong>
        <button class="btn ghost" onclick="openAddModal()">+ New Appointment</button>
      </div>

      <div class="stats">
        <div class="stat">
          <div>
            <div class="small">Appointments</div>
            <strong id="statTotal">0</strong>
          </div>
          <div class="small" id="statToday">Today: 0</div>
        </div>
        <div class="stat">
          <div>
            <div class="small">Queue Length</div>
            <strong id="statQueue">0</strong>
          </div>
          <div class="small">Next: <span id="nextPatient">—</span></div>
        </div>
      </div>

      <div class="alerts" id="alerts"></div>

      <div class="calendar panel" style="margin-top:12px;padding:10px">
        <strong>Calendar</strong>
        <div id="monthLabel" style="margin-top:6px;color:var(--muted)"></div>
        <div class="cal-days" id="calendarDays" style="margin-top:8px"></div>
      </div>
    </aside>

    <section>
      <div class="panel">
        <div class="toolbar">
          <input id="searchInput" class="search" placeholder="Search by patient or doctor" oninput="renderList()" />
          <select id="filterDoctor" onchange="renderList()"><option value="">All Doctors</option></select>
          <select id="filterStatus" onchange="renderList()"><option value="">All Statuses</option><option value="pending">Pending</option><option value="completed">Completed</option><option value="cancelled">Cancelled</option></select>
        </div>

        <div style="overflow:auto;max-height:520px">
          <table>
            <thead>
              <tr><th>Time</th><th>Patient</th><th>Doctor</th><th>Reason</th><th>Status</th><th style="width:190px">Actions</th></tr>
            </thead>
            <tbody id="appointmentsTable"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Add/Edit Modal -->
  <div id="modal" class="overlay">
    <div class="modal">
      <h3 id="modalTitle">New Appointment</h3>
      <div class="form-grid" style="margin-top:8px">
        <input id="inpPatient" placeholder="Patient name" />
        <input id="inpAge" placeholder="Age" type="number" />
        <select id="inpGender"><option value="">Gender</option><option>Male</option><option>Female</option><option>Other</option></select>
        <input id="inpPhone" placeholder="Phone" />
        <input id="inpDoctor" placeholder="Doctor / Specialization" />
        <input id="inpDate" type="datetime-local" />
        <input id="inpReason" placeholder="Reason for visit" style="grid-column:1/3" />
      </div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:10px">
        <button class="btn ghost" onclick="closeModal()">Cancel</button>
        <button class="btn" onclick="saveAppointment()">Save</button>
      </div>
    </div>
  </div>

  <footer>Tip: This demo uses localStorage. To reset data clear browser storage.</footer>

  <script>
    // ---------- sample data ----------
    const sampleAppointments = [
      {id:genId(),patient:'Asha R',age:29,gender:'Female',phone:'9876543210',doctor:'Dr. Rao (Cardiology)',date:addMinutes(new Date(),40).toISOString(),reason:'Follow-up',status:'pending'},
      {id:genId(),patient:'Vikram S',age:42,gender:'Male',phone:'9123456780',doctor:'Dr. Mehta (General)',date:addMinutes(new Date(),-20).toISOString(),reason:'Check-up',status:'completed'},
      {id:genId(),patient:'Neha P',age:35,gender:'Female',phone:'9988776655',doctor:'Dr. Rao (Cardiology)',date:addMinutes(new Date(),90).toISOString(),reason:'Chest pain',status:'pending'},
    ];

    // ---------- state ----------
    let appointments = JSON.parse(localStorage.getItem('appointments')||'null') || sampleAppointments;
    let editingId = null;

    // ---------- init ----------
    document.addEventListener('DOMContentLoaded',()=>{
      populateDoctorFilter(); buildCalendar(); renderList(); updateStats(); startAlertChecker();
    });

    // ---------- utilities ----------
    function genId(){ return 'APPT-'+Date.now().toString(36)+'-'+Math.random().toString(36).slice(2,6).toUpperCase(); }
    function addMinutes(d, m){ return new Date(d.getTime() + m*60000); }
    function formatDateTime(iso){ const d=new Date(iso); return d.toLocaleString(); }

    // ---------- storage ----------
    function saveToStorage(){ localStorage.setItem('appointments', JSON.stringify(appointments)); }

    // ---------- UI helpers ----------
    function populateDoctorFilter(){
      const doctors = [...new Set(appointments.map(a=>a.doctor))];
      const sel = document.getElementById('filterDoctor'); sel.innerHTML='<option value="">All Doctors</option>';
      doctors.forEach(d=>{ const o=document.createElement('option'); o.value=d; o.textContent=d; sel.appendChild(o); });
    }

    function renderList(){
      const tbody = document.getElementById('appointmentsTable'); tbody.innerHTML='';
      const q = document.getElementById('searchInput').value.trim().toLowerCase();
      const fd = document.getElementById('filterDoctor').value;
      const fs = document.getElementById('filterStatus').value;
      const sorted = appointments.slice().sort((a,b)=> new Date(a.date)-new Date(b.date));
      const now = new Date();
      sorted.forEach(app=>{
        if(q && !(app.patient.toLowerCase().includes(q) || app.doctor.toLowerCase().includes(q) || app.reason.toLowerCase().includes(q))) return;
        if(fd && app.doctor!==fd) return;
        if(fs && app.status!==fs) return;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${formatDateTime(app.date)}</td>
          <td><strong>${app.patient}</strong><div class="small">Age: ${app.age} • ${app.gender}</div></td>
          <td>${app.doctor}<div class="small">${app.phone || ''}</div></td>
          <td>${app.reason}</td>
          <td><span class="status ${app.status}">${capitalize(app.status)}</span></td>
          <td class="actions">
            <button class="btn ghost" onclick="openEdit('${app.id}')">Edit</button>
            <button class="btn" onclick="markNext('${app.id}')">Next</button>
            <button class="btn ghost" onclick="changeStatus('${app.id}','completed')">Complete</button>
            <button class="btn ghost" onclick="changeStatus('${app.id}','cancelled')">Cancel</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      populateDoctorFilter(); updateStats(); buildCalendar(); saveToStorage();
    }

    function capitalize(s){ return s? s.charAt(0).toUpperCase()+s.slice(1):'' }

    // ---------- modal actions ----------
    function openAddModal(){ editingId = null; document.getElementById('modalTitle').textContent='New Appointment'; clearForm(); document.getElementById('modal').classList.add('show'); }
    function openEdit(id){ editingId = id; const a = appointments.find(x=>x.id===id); if(!a) return; document.getElementById('modalTitle').textContent='Edit Appointment'; fillForm(a); document.getElementById('modal').classList.add('show'); }
    function closeModal(){ document.getElementById('modal').classList.remove('show'); }

    function clearForm(){ document.getElementById('inpPatient').value=''; document.getElementById('inpAge').value=''; document.getElementById('inpGender').value=''; document.getElementById('inpPhone').value=''; document.getElementById('inpDoctor').value=''; document.getElementById('inpDate').value=''; document.getElementById('inpReason').value=''; }
    function fillForm(a){ document.getElementById('inpPatient').value=a.patient; document.getElementById('inpAge').value=a.age; document.getElementById('inpGender').value=a.gender; document.getElementById('inpPhone').value=a.phone; document.getElementById('inpDoctor').value=a.doctor; document.getElementById('inpDate').value=new Date(a.date).toISOString().slice(0,16); document.getElementById('inpReason').value=a.reason; }

    function saveAppointment(){
      const patient = document.getElementById('inpPatient').value.trim();
      const age = Number(document.getElementById('inpAge').value) || '';
      const gender = document.getElementById('inpGender').value;
      const phone = document.getElementById('inpPhone').value.trim();
      const doctor = document.getElementById('inpDoctor').value.trim();
      const date = document.getElementById('inpDate').value;
      const reason = document.getElementById('inpReason').value.trim();

      if(!patient || !doctor || !date){ alert('Please fill patient name, doctor and date/time.'); return; }
      if(editingId){
        const idx = appointments.findIndex(a=>a.id===editingId); if(idx>-1){ appointments[idx] = {...appointments[idx],patient,age,gender,phone,doctor,date:new Date(date).toISOString(),reason}; }
      } else {
        appointments.push({id:genId(),patient,age,gender,phone,doctor,date:new Date(date).toISOString(),reason,status:'pending'});
      }
      closeModal(); renderList();
    }

    // ---------- queue / actions ----------
    function markNext(id){ // simulate calling patient
      const a = appointments.find(x=>x.id===id);
      if(!a) return; alert('Calling next: '+a.patient+' ('+a.doctor+')'); document.getElementById('nextPatient').textContent = a.patient; updateStats();
    }

    function changeStatus(id,newStatus){ const a = appointments.find(x=>x.id===id); if(!a) return; a.status = newStatus; renderList(); }

    // ---------- stats & alerts ----------
    function updateStats(){
      const total = appointments.length; document.getElementById('statTotal').textContent = total;
      const todayCount = appointments.filter(a=> new Date(a.date).toDateString() === new Date().toDateString()).length;
      document.getElementById('statToday').textContent = 'Today: '+todayCount;
      const queueLen = appointments.filter(a=> a.status==='pending' && new Date(a.date) >= new Date()).length;
      document.getElementById('statQueue').textContent = queueLen;
      const next = appointments.filter(a=> a.status==='pending' && new Date(a.date) >= new Date()).sort((x,y)=> new Date(x.date)-new Date(y.date))[0];
      document.getElementById('nextPatient').textContent = next? (next.patient+' @ '+new Date(next.date).toLocaleTimeString()): '—';

      // alerts
      const alertsEl = document.getElementById('alerts'); alertsEl.innerHTML='';
      if(queueLen >= 10){ const d=document.createElement('div'); d.className='alert danger'; d.textContent = 'Queue is long — '+queueLen+' patients waiting.'; alertsEl.appendChild(d); }
    }

    // check for upcoming appointments within 30 minutes
    function startAlertChecker(){
      checkUpcoming(); setInterval(checkUpcoming, 60*1000); // every minute
    }
    function checkUpcoming(){
      const now = new Date();
      const soon = appointments.filter(a=> a.status==='pending' && (new Date(a.date) - now) <= 30*60*1000 && (new Date(a.date) - now) > 0);
      const alertsEl = document.getElementById('alerts');
      // remove existing upcoming alerts
      [...alertsEl.querySelectorAll('.alert.upcoming')].forEach(n=>n.remove());
      soon.slice(0,3).forEach(a=>{
        const d = document.createElement('div'); d.className='alert warn upcoming'; d.textContent = `Upcoming: ${a.patient} with ${a.doctor} at ${new Date(a.date).toLocaleTimeString()}`; alertsEl.appendChild(d);
      });
      updateStats();
    }

    // ---------- calendar ----------
    function buildCalendar(){
      const cal = document.getElementById('calendarDays'); cal.innerHTML='';
      const now = new Date(); const month = now.getMonth(); const year = now.getFullYear(); document.getElementById('monthLabel').textContent = now.toLocaleString(undefined,{month:'long',year:'numeric'});
      const daysInMonth = new Date(year, month+1, 0).getDate();
      const datesWith = new Set(appointments.map(a=> new Date(a.date).toISOString().split('T')[0]));
      for(let d=1; d<=daysInMonth; d++){
        const iso = new Date(year,month,d).toISOString().split('T')[0];
        const el = document.createElement('div'); el.className='cal-day'; el.textContent = d;
        if(datesWith.has(iso)) el.classList.add('has-appoint');
        el.onclick = ()=>{ document.getElementById('searchInput').value=''; document.getElementById('filterDoctor').value=''; document.getElementById('filterStatus').value=''; filterByDate(iso); }
        cal.appendChild(el);
      }
    }
    function filterByDate(iso){ appointments = JSON.parse(localStorage.getItem('appointments')||'[]') || appointments; // reload
      document.getElementById('searchInput').value='';
      const tbody = document.getElementById('appointmentsTable'); tbody.innerHTML='';
      const filtered = appointments.filter(a=> new Date(a.date).toISOString().split('T')[0]===iso);
      filtered.sort((a,b)=> new Date(a.date)-new Date(b.date)).forEach(app=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${formatDateTime(app.date)}</td><td><strong>${app.patient}</strong><div class="small">Age: ${app.age}</div></td><td>${app.doctor}</td><td>${app.reason}</td><td><span class="status ${app.status}">${capitalize(app.status)}</span></td><td></td>`;
        tbody.appendChild(tr);
      });
    }

    // ---------- helpers ----------
    // initialize storage if empty
    if(!localStorage.getItem('appointments')){ localStorage.setItem('appointments', JSON.stringify(appointments)); }

  </script>
</body>
</html>